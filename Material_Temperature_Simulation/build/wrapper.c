#include "material_temperature_simulation.h"
#include <stdlib.h>
#include <unistd.h>
#include <sys/syscall.h>

typedef struct capacity {
  int initial;
  int mod1;
  int mod2;
  int mod3;
  int mod4;
  int mod5;
  int mod6;
  int mod7;
} capacity_t;

typedef struct temps {
  int flag;
  int num;
  int vals[100];
} msg_t;

typedef struct msg {
  int material;
  capacity thermal;
  capacity heat;
  int xDim;
  int yDim;
  int zDim;
  temps isotherm;
  temps constEn;
  int runTime;
} msg_t;

extern int generateRandomValue(_Bool lflag, _Bool uflag, int lbound, int ubound) {
  if (lbound == 0 && ubound == 0) {
    int s;
    syscall(SYS_getrandom, &s, sizeof(int), 1);
    return rand();
  } else {
    int min = lflag ? lbound : lbound+1;
    int max = uflag ? ubound : ubound-1;
    int range = max - min + 1;
    int s;
    syscall(SYS_getrandom, &s, sizeof(int), 1);
    double rnd = ((double) rand())/(1.0 + ((double) RAND_MAX));
    if (rnd < 0) rnd = rnd * -1;
    int value = ((int) (((double) range)*rnd));
    return value + min;
  }
}

msg_t step() {
  updateFunction();
  msg_t msg;
  msg.material          = material[0];

  msg.thermal.initial   = thermInit[0];
  msg.thermal.mod1      = thermMod1[0];
  msg.thermal.mod2      = thermMod2[0];
  msg.thermal.mod3      = thermMod3[0];
  msg.thermal.mod4      = thermMod4[0];
  msg.thermal.mod5      = thermMod5[0];
  msg.thermal.mod6      = thermMod6[0];
  msg.thermal.mod7      = thermMod7[0];
  msg.heat.initial      = heatInit[0];
  msg.heat.mod1         = heatMod1[0];
  msg.heat.mod2         = heatMod2[0];
  msg.heat.mod3         = heatMod3[0];
  msg.heat.mod4         = heatMod4[0];
  msg.heat.mod5         = heatMod5[0];
  msg.heat.mod6         = heatMod6[0];
  msg.heat.mod7         = heatMod7[0];

  msg.xDim              = xDim[0];
  msg.yDim              = yDim[0];
  msg.zDim              = zDim[0];

  msg.isotherm.flag     = isoFlag[0];
  msg.isotherm.num      = isoNum[0];
  msg.isotherm.vals[0]  = isoVal0[0];
  msg.isotherm.vals[2]  = isoVal2[0];
  msg.isotherm.vals[2]  = isoVal2[0];
  msg.isotherm.vals[3]  = isoVal3[0];
  msg.isotherm.vals[4]  = isoVal4[0];
  msg.isotherm.vals[5]  = isoVal5[0];
  msg.isotherm.vals[6]  = isoVal6[0];
  msg.isotherm.vals[7]  = isoVal7[0];
  msg.isotherm.vals[8]  = isoVal8[0];
  msg.isotherm.vals[9]  = isoVal9[0];
  msg.isotherm.vals[10] = isoVal10[0];
  msg.isotherm.vals[11] = isoVal11[0];
  msg.isotherm.vals[12] = isoVal12[0];
  msg.isotherm.vals[13] = isoVal13[0];
  msg.isotherm.vals[14] = isoVal14[0];
  msg.isotherm.vals[15] = isoVal15[0];
  msg.isotherm.vals[16] = isoVal16[0];
  msg.isotherm.vals[17] = isoVal17[0];
  msg.isotherm.vals[18] = isoVal18[0];
  msg.isotherm.vals[19] = isoVal19[0];
  msg.isotherm.vals[20] = isoVal20[0];
  msg.isotherm.vals[21] = isoVal21[0];
  msg.isotherm.vals[22] = isoVal22[0];
  msg.isotherm.vals[23] = isoVal23[0];
  msg.isotherm.vals[24] = isoVal24[0];
  msg.isotherm.vals[25] = isoVal25[0];
  msg.isotherm.vals[26] = isoVal26[0];
  msg.isotherm.vals[27] = isoVal27[0];
  msg.isotherm.vals[28] = isoVal28[0];
  msg.isotherm.vals[29] = isoVal29[0];
  msg.isotherm.vals[30] = isoVal30[0];
  msg.isotherm.vals[31] = isoVal31[0];
  msg.isotherm.vals[32] = isoVal32[0];
  msg.isotherm.vals[33] = isoVal33[0];
  msg.isotherm.vals[34] = isoVal34[0];
  msg.isotherm.vals[35] = isoVal35[0];
  msg.isotherm.vals[36] = isoVal36[0];
  msg.isotherm.vals[37] = isoVal37[0];
  msg.isotherm.vals[38] = isoVal38[0];
  msg.isotherm.vals[39] = isoVal39[0];
  msg.isotherm.vals[40] = isoVal40[0];
  msg.isotherm.vals[41] = isoVal41[0];
  msg.isotherm.vals[42] = isoVal42[0];
  msg.isotherm.vals[43] = isoVal43[0];
  msg.isotherm.vals[44] = isoVal44[0];
  msg.isotherm.vals[45] = isoVal45[0];
  msg.isotherm.vals[46] = isoVal46[0];
  msg.isotherm.vals[47] = isoVal47[0];
  msg.isotherm.vals[48] = isoVal48[0];
  msg.isotherm.vals[49] = isoVal49[0];
  msg.isotherm.vals[50] = isoVal50[0];
  msg.isotherm.vals[51] = isoVal51[0];
  msg.isotherm.vals[52] = isoVal52[0];
  msg.isotherm.vals[53] = isoVal53[0];
  msg.isotherm.vals[54] = isoVal54[0];
  msg.isotherm.vals[55] = isoVal55[0];
  msg.isotherm.vals[56] = isoVal56[0];
  msg.isotherm.vals[57] = isoVal57[0];
  msg.isotherm.vals[58] = isoVal58[0];
  msg.isotherm.vals[59] = isoVal59[0];
  msg.isotherm.vals[60] = isoVal60[0];
  msg.isotherm.vals[61] = isoVal61[0];
  msg.isotherm.vals[62] = isoVal62[0];
  msg.isotherm.vals[63] = isoVal63[0];
  msg.isotherm.vals[64] = isoVal64[0];
  msg.isotherm.vals[65] = isoVal65[0];
  msg.isotherm.vals[66] = isoVal66[0];
  msg.isotherm.vals[67] = isoVal67[0];
  msg.isotherm.vals[68] = isoVal68[0];
  msg.isotherm.vals[69] = isoVal69[0];
  msg.isotherm.vals[70] = isoVal70[0];
  msg.isotherm.vals[71] = isoVal71[0];
  msg.isotherm.vals[72] = isoVal72[0];
  msg.isotherm.vals[73] = isoVal73[0];
  msg.isotherm.vals[74] = isoVal74[0];
  msg.isotherm.vals[75] = isoVal75[0];
  msg.isotherm.vals[76] = isoVal76[0];
  msg.isotherm.vals[77] = isoVal77[0];
  msg.isotherm.vals[78] = isoVal78[0];
  msg.isotherm.vals[79] = isoVal79[0];
  msg.isotherm.vals[80] = isoVal80[0];
  msg.isotherm.vals[81] = isoVal81[0];
  msg.isotherm.vals[82] = isoVal82[0];
  msg.isotherm.vals[83] = isoVal83[0];
  msg.isotherm.vals[84] = isoVal84[0];
  msg.isotherm.vals[85] = isoVal85[0];
  msg.isotherm.vals[86] = isoVal86[0];
  msg.isotherm.vals[87] = isoVal87[0];
  msg.isotherm.vals[88] = isoVal88[0];
  msg.isotherm.vals[89] = isoVal89[0];
  msg.isotherm.vals[90] = isoVal90[0];
  msg.isotherm.vals[91] = isoVal91[0];
  msg.isotherm.vals[92] = isoVal92[0];
  msg.isotherm.vals[93] = isoVal93[0];
  msg.isotherm.vals[94] = isoVal94[0];
  msg.isotherm.vals[95] = isoVal95[0];
  msg.isotherm.vals[96] = isoVal96[0];
  msg.isotherm.vals[97] = isoVal97[0];
  msg.isotherm.vals[98] = isoVal98[0];
  msg.isotherm.vals[99] = isoVal99[0];

  msg.constEn.flag      = constEnFlag[0];
  msg.constEn.num       = constEnNum[0];
  msg.constEn.vals[0]   = constEnVal0[0];
  msg.constEn.vals[2]   = constEnVal2[0];
  msg.constEn.vals[2]   = constEnVal2[0];
  msg.constEn.vals[3]   = constEnVal3[0];
  msg.constEn.vals[4]   = constEnVal4[0];
  msg.constEn.vals[5]   = constEnVal5[0];
  msg.constEn.vals[6]   = constEnVal6[0];
  msg.constEn.vals[7]   = constEnVal7[0];
  msg.constEn.vals[8]   = constEnVal8[0];
  msg.constEn.vals[9]   = constEnVal9[0];
  msg.constEn.vals[10]  = constEnVal10[0];
  msg.constEn.vals[11]  = constEnVal11[0];
  msg.constEn.vals[12]  = constEnVal12[0];
  msg.constEn.vals[13]  = constEnVal13[0];
  msg.constEn.vals[14]  = constEnVal14[0];
  msg.constEn.vals[15]  = constEnVal15[0];
  msg.constEn.vals[16]  = constEnVal16[0];
  msg.constEn.vals[17]  = constEnVal17[0];
  msg.constEn.vals[18]  = constEnVal18[0];
  msg.constEn.vals[19]  = constEnVal19[0];
  msg.constEn.vals[20]  = constEnVal20[0];
  msg.constEn.vals[21]  = constEnVal21[0];
  msg.constEn.vals[22]  = constEnVal22[0];
  msg.constEn.vals[23]  = constEnVal23[0];
  msg.constEn.vals[24]  = constEnVal24[0];
  msg.constEn.vals[25]  = constEnVal25[0];
  msg.constEn.vals[26]  = constEnVal26[0];
  msg.constEn.vals[27]  = constEnVal27[0];
  msg.constEn.vals[28]  = constEnVal28[0];
  msg.constEn.vals[29]  = constEnVal29[0];
  msg.constEn.vals[30]  = constEnVal30[0];
  msg.constEn.vals[31]  = constEnVal31[0];
  msg.constEn.vals[32]  = constEnVal32[0];
  msg.constEn.vals[33]  = constEnVal33[0];
  msg.constEn.vals[34]  = constEnVal34[0];
  msg.constEn.vals[35]  = constEnVal35[0];
  msg.constEn.vals[36]  = constEnVal36[0];
  msg.constEn.vals[37]  = constEnVal37[0];
  msg.constEn.vals[38]  = constEnVal38[0];
  msg.constEn.vals[39]  = constEnVal39[0];
  msg.constEn.vals[40]  = constEnVal40[0];
  msg.constEn.vals[41]  = constEnVal41[0];
  msg.constEn.vals[42]  = constEnVal42[0];
  msg.constEn.vals[43]  = constEnVal43[0];
  msg.constEn.vals[44]  = constEnVal44[0];
  msg.constEn.vals[45]  = constEnVal45[0];
  msg.constEn.vals[46]  = constEnVal46[0];
  msg.constEn.vals[47]  = constEnVal47[0];
  msg.constEn.vals[48]  = constEnVal48[0];
  msg.constEn.vals[49]  = constEnVal49[0];
  msg.constEn.vals[50]  = constEnVal50[0];
  msg.constEn.vals[51]  = constEnVal51[0];
  msg.constEn.vals[52]  = constEnVal52[0];
  msg.constEn.vals[53]  = constEnVal53[0];
  msg.constEn.vals[54]  = constEnVal54[0];
  msg.constEn.vals[55]  = constEnVal55[0];
  msg.constEn.vals[56]  = constEnVal56[0];
  msg.constEn.vals[57]  = constEnVal57[0];
  msg.constEn.vals[58]  = constEnVal58[0];
  msg.constEn.vals[59]  = constEnVal59[0];
  msg.constEn.vals[60]  = constEnVal60[0];
  msg.constEn.vals[61]  = constEnVal61[0];
  msg.constEn.vals[62]  = constEnVal62[0];
  msg.constEn.vals[63]  = constEnVal63[0];
  msg.constEn.vals[64]  = constEnVal64[0];
  msg.constEn.vals[65]  = constEnVal65[0];
  msg.constEn.vals[66]  = constEnVal66[0];
  msg.constEn.vals[67]  = constEnVal67[0];
  msg.constEn.vals[68]  = constEnVal68[0];
  msg.constEn.vals[69]  = constEnVal69[0];
  msg.constEn.vals[70]  = constEnVal70[0];
  msg.constEn.vals[71]  = constEnVal71[0];
  msg.constEn.vals[72]  = constEnVal72[0];
  msg.constEn.vals[73]  = constEnVal73[0];
  msg.constEn.vals[74]  = constEnVal74[0];
  msg.constEn.vals[75]  = constEnVal75[0];
  msg.constEn.vals[76]  = constEnVal76[0];
  msg.constEn.vals[77]  = constEnVal77[0];
  msg.constEn.vals[78]  = constEnVal78[0];
  msg.constEn.vals[79]  = constEnVal79[0];
  msg.constEn.vals[80]  = constEnVal80[0];
  msg.constEn.vals[81]  = constEnVal81[0];
  msg.constEn.vals[82]  = constEnVal82[0];
  msg.constEn.vals[83]  = constEnVal83[0];
  msg.constEn.vals[84]  = constEnVal84[0];
  msg.constEn.vals[85]  = constEnVal85[0];
  msg.constEn.vals[86]  = constEnVal86[0];
  msg.constEn.vals[87]  = constEnVal87[0];
  msg.constEn.vals[88]  = constEnVal88[0];
  msg.constEn.vals[89]  = constEnVal89[0];
  msg.constEn.vals[90]  = constEnVal90[0];
  msg.constEn.vals[91]  = constEnVal91[0];
  msg.constEn.vals[92]  = constEnVal92[0];
  msg.constEn.vals[93]  = constEnVal93[0];
  msg.constEn.vals[94]  = constEnVal94[0];
  msg.constEn.vals[95]  = constEnVal95[0];
  msg.constEn.vals[96]  = constEnVal96[0];
  msg.constEn.vals[97]  = constEnVal97[0];
  msg.constEn.vals[98]  = constEnVal98[0];
  msg.constEn.vals[99]  = constEnVal99[0];

  msg.runTime           = runTime[0];
  return msg;
}
