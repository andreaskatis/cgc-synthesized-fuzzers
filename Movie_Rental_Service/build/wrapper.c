#include "movie_rental_service.h"
#include <stdlib.h>
#include <unistd.h>
#include <sys/syscall.h>

typedef struct passStr {
  int length;
  int chas[65];
} passStr_t;

typedef struct titleDesc {
  int length;
  int chas[100];
} titleDesc_t;

typedef struct add {
  titleDesc title;
  titleDesc desc;
  int year;
  int score;
  int genre;
  int rating;
} add_t;

typedef struct msg {
  int main;
  int movID;
  int flag;
  passStr password;
  int admin;
  add addVal;
} msg_t;

extern int generateRandomValue(_Bool lflag, _Bool uflag, int lbound, int ubound) {
  if (lbound == 0 && ubound == 0) {
    int s;
    syscall(SYS_getrandom, &s, sizeof(int), 1);
    return rand();
  } else {
    int min = lflag ? lbound : lbound+1;
    int max = uflag ? ubound : ubound-1;
    int range = max - min + 1;
    int s;
    syscall(SYS_getrandom, &s, sizeof(int), 1);
    double rnd = ((double) rand())/(1.0 + ((double) RAND_MAX));
    if (rnd < 0) rnd = rnd * -1;
    int value = ((int) (((double) range)*rnd));
    return value + min;
  }
}

msg_t step() {
  updateFunction();
  msg_t msg;
  msg.main                  = main[0];
  msg.movID                 = movID[0];
  msg.flag                  = flag[0];

  msg.passStr.length        = passLength[0];
  msg.passStr.chas[0]       = passCha0[0];
  msg.passStr.chas[1]       = passCha1[0];
  msg.passStr.chas[2]       = passCha2[0];
  msg.passStr.chas[3]       = passCha3[0];
  msg.passStr.chas[4]       = passCha4[0];
  msg.passStr.chas[5]       = passCha5[0];
  msg.passStr.chas[6]       = passCha6[0];
  msg.passStr.chas[7]       = passCha7[0];
  msg.passStr.chas[8]       = passCha8[0];
  msg.passStr.chas[9]       = passCha9[0];
  msg.passStr.chas[10]      = passCha10[0];
  msg.passStr.chas[11]      = passCha11[0];
  msg.passStr.chas[12]      = passCha12[0];
  msg.passStr.chas[13]      = passCha13[0];
  msg.passStr.chas[14]      = passCha14[0];
  msg.passStr.chas[15]      = passCha15[0];
  msg.passStr.chas[16]      = passCha16[0];
  msg.passStr.chas[17]      = passCha17[0];
  msg.passStr.chas[18]      = passCha18[0];
  msg.passStr.chas[19]      = passCha19[0];
  msg.passStr.chas[20]      = passCha20[0];
  msg.passStr.chas[21]      = passCha21[0];
  msg.passStr.chas[22]      = passCha22[0];
  msg.passStr.chas[23]      = passCha23[0];
  msg.passStr.chas[24]      = passCha24[0];
  msg.passStr.chas[25]      = passCha25[0];
  msg.passStr.chas[26]      = passCha26[0];
  msg.passStr.chas[27]      = passCha27[0];
  msg.passStr.chas[28]      = passCha28[0];
  msg.passStr.chas[29]      = passCha29[0];
  msg.passStr.chas[30]      = passCha30[0];
  msg.passStr.chas[31]      = passCha31[0];
  msg.passStr.chas[32]      = passCha32[0];
  msg.passStr.chas[33]      = passCha33[0];
  msg.passStr.chas[34]      = passCha34[0];
  msg.passStr.chas[35]      = passCha35[0];
  msg.passStr.chas[36]      = passCha36[0];
  msg.passStr.chas[37]      = passCha37[0];
  msg.passStr.chas[38]      = passCha38[0];
  msg.passStr.chas[39]      = passCha39[0];
  msg.passStr.chas[40]      = passCha40[0];
  msg.passStr.chas[41]      = passCha41[0];
  msg.passStr.chas[42]      = passCha42[0];
  msg.passStr.chas[43]      = passCha43[0];
  msg.passStr.chas[44]      = passCha44[0];
  msg.passStr.chas[45]      = passCha45[0];
  msg.passStr.chas[46]      = passCha46[0];
  msg.passStr.chas[47]      = passCha47[0];
  msg.passStr.chas[48]      = passCha48[0];
  msg.passStr.chas[49]      = passCha49[0];
  msg.passStr.chas[50]      = passCha50[0];
  msg.passStr.chas[51]      = passCha51[0];
  msg.passStr.chas[52]      = passCha52[0];
  msg.passStr.chas[53]      = passCha53[0];
  msg.passStr.chas[54]      = passCha54[0];
  msg.passStr.chas[55]      = passCha55[0];
  msg.passStr.chas[56]      = passCha56[0];
  msg.passStr.chas[57]      = passCha57[0];
  msg.passStr.chas[58]      = passCha58[0];
  msg.passStr.chas[59]      = passCha59[0];
  msg.passStr.chas[60]      = passCha60[0];
  msg.passStr.chas[61]      = passCha61[0];
  msg.passStr.chas[62]      = passCha62[0];
  msg.passStr.chas[63]      = passCha63[0];
  msg.passStr.chas[64]      = passCha64[0];

  msg.admin                 = admin[0];

  msg.addVal.title.length   = titleLength[0];
  msg.addVal.title.chas[0]  = titleCha0[0];
  msg.addVal.title.chas[1]  = titleCha1[0];
  msg.addVal.title.chas[2]  = titleCha2[0];
  msg.addVal.title.chas[3]  = titleCha3[0];
  msg.addVal.title.chas[4]  = titleCha4[0];
  msg.addVal.title.chas[5]  = titleCha5[0];
  msg.addVal.title.chas[6]  = titleCha6[0];
  msg.addVal.title.chas[7]  = titleCha7[0];
  msg.addVal.title.chas[8]  = titleCha8[0];
  msg.addVal.title.chas[9]  = titleCha9[0];
  msg.addVal.title.chas[10] = titleCha10[0];
  msg.addVal.title.chas[11] = titleCha11[0];
  msg.addVal.title.chas[12] = titleCha12[0];
  msg.addVal.title.chas[13] = titleCha13[0];
  msg.addVal.title.chas[14] = titleCha14[0];
  msg.addVal.title.chas[15] = titleCha15[0];
  msg.addVal.title.chas[16] = titleCha16[0];
  msg.addVal.title.chas[17] = titleCha17[0];
  msg.addVal.title.chas[18] = titleCha18[0];
  msg.addVal.title.chas[19] = titleCha19[0];
  msg.addVal.title.chas[20] = titleCha20[0];
  msg.addVal.title.chas[21] = titleCha21[0];
  msg.addVal.title.chas[22] = titleCha22[0];
  msg.addVal.title.chas[23] = titleCha23[0];
  msg.addVal.title.chas[24] = titleCha24[0];
  msg.addVal.title.chas[25] = titleCha25[0];
  msg.addVal.title.chas[26] = titleCha26[0];
  msg.addVal.title.chas[27] = titleCha27[0];
  msg.addVal.title.chas[28] = titleCha28[0];
  msg.addVal.title.chas[29] = titleCha29[0];
  msg.addVal.title.chas[30] = titleCha30[0];
  msg.addVal.title.chas[31] = titleCha31[0];
  msg.addVal.title.chas[32] = titleCha32[0];
  msg.addVal.title.chas[33] = titleCha33[0];
  msg.addVal.title.chas[34] = titleCha34[0];
  msg.addVal.title.chas[35] = titleCha35[0];
  msg.addVal.title.chas[36] = titleCha36[0];
  msg.addVal.title.chas[37] = titleCha37[0];
  msg.addVal.title.chas[38] = titleCha38[0];
  msg.addVal.title.chas[39] = titleCha39[0];
  msg.addVal.title.chas[40] = titleCha40[0];
  msg.addVal.title.chas[41] = titleCha41[0];
  msg.addVal.title.chas[42] = titleCha42[0];
  msg.addVal.title.chas[43] = titleCha43[0];
  msg.addVal.title.chas[44] = titleCha44[0];
  msg.addVal.title.chas[45] = titleCha45[0];
  msg.addVal.title.chas[46] = titleCha46[0];
  msg.addVal.title.chas[47] = titleCha47[0];
  msg.addVal.title.chas[48] = titleCha48[0];
  msg.addVal.title.chas[49] = titleCha49[0];
  msg.addVal.title.chas[50] = titleCha50[0];
  msg.addVal.title.chas[51] = titleCha51[0];
  msg.addVal.title.chas[52] = titleCha52[0];
  msg.addVal.title.chas[53] = titleCha53[0];
  msg.addVal.title.chas[54] = titleCha54[0];
  msg.addVal.title.chas[55] = titleCha55[0];
  msg.addVal.title.chas[56] = titleCha56[0];
  msg.addVal.title.chas[57] = titleCha57[0];
  msg.addVal.title.chas[58] = titleCha58[0];
  msg.addVal.title.chas[59] = titleCha59[0];
  msg.addVal.title.chas[60] = titleCha60[0];
  msg.addVal.title.chas[61] = titleCha61[0];
  msg.addVal.title.chas[62] = titleCha62[0];
  msg.addVal.title.chas[63] = titleCha63[0];
  msg.addVal.title.chas[64] = titleCha64[0];
  msg.addVal.title.chas[65] = titleCha65[0];
  msg.addVal.title.chas[66] = titleCha66[0];
  msg.addVal.title.chas[67] = titleCha67[0];
  msg.addVal.title.chas[68] = titleCha68[0];
  msg.addVal.title.chas[69] = titleCha69[0];
  msg.addVal.title.chas[70] = titleCha70[0];
  msg.addVal.title.chas[71] = titleCha71[0];
  msg.addVal.title.chas[72] = titleCha72[0];
  msg.addVal.title.chas[73] = titleCha73[0];
  msg.addVal.title.chas[74] = titleCha74[0];
  msg.addVal.title.chas[75] = titleCha75[0];
  msg.addVal.title.chas[76] = titleCha76[0];
  msg.addVal.title.chas[77] = titleCha77[0];
  msg.addVal.title.chas[78] = titleCha78[0];
  msg.addVal.title.chas[79] = titleCha79[0];
  msg.addVal.title.chas[80] = titleCha80[0];
  msg.addVal.title.chas[81] = titleCha81[0];
  msg.addVal.title.chas[82] = titleCha82[0];
  msg.addVal.title.chas[83] = titleCha83[0];
  msg.addVal.title.chas[84] = titleCha84[0];
  msg.addVal.title.chas[85] = titleCha85[0];
  msg.addVal.title.chas[86] = titleCha86[0];
  msg.addVal.title.chas[87] = titleCha87[0];
  msg.addVal.title.chas[88] = titleCha88[0];
  msg.addVal.title.chas[89] = titleCha89[0];
  msg.addVal.title.chas[90] = titleCha90[0];
  msg.addVal.title.chas[91] = titleCha91[0];
  msg.addVal.title.chas[92] = titleCha92[0];
  msg.addVal.title.chas[93] = titleCha93[0];
  msg.addVal.title.chas[94] = titleCha94[0];
  msg.addVal.title.chas[95] = titleCha95[0];
  msg.addVal.title.chas[96] = titleCha96[0];
  msg.addVal.title.chas[97] = titleCha97[0];
  msg.addVal.title.chas[98] = titleCha98[0];
  msg.addVal.title.chas[99] = titleCha99[0];

  msg.addVal.desc.length    = descLength[0];
  msg.addVal.desc.chas[0]   = descCha0[0];
  msg.addVal.desc.chas[1]   = descCha1[0];
  msg.addVal.desc.chas[2]   = descCha2[0];
  msg.addVal.desc.chas[3]   = descCha3[0];
  msg.addVal.desc.chas[4]   = descCha4[0];
  msg.addVal.desc.chas[5]   = descCha5[0];
  msg.addVal.desc.chas[6]   = descCha6[0];
  msg.addVal.desc.chas[7]   = descCha7[0];
  msg.addVal.desc.chas[8]   = descCha8[0];
  msg.addVal.desc.chas[9]   = descCha9[0];
  msg.addVal.desc.chas[10]  = descCha10[0];
  msg.addVal.desc.chas[11]  = descCha11[0];
  msg.addVal.desc.chas[12]  = descCha12[0];
  msg.addVal.desc.chas[13]  = descCha13[0];
  msg.addVal.desc.chas[14]  = descCha14[0];
  msg.addVal.desc.chas[15]  = descCha15[0];
  msg.addVal.desc.chas[16]  = descCha16[0];
  msg.addVal.desc.chas[17]  = descCha17[0];
  msg.addVal.desc.chas[18]  = descCha18[0];
  msg.addVal.desc.chas[19]  = descCha19[0];
  msg.addVal.desc.chas[20]  = descCha20[0];
  msg.addVal.desc.chas[21]  = descCha21[0];
  msg.addVal.desc.chas[22]  = descCha22[0];
  msg.addVal.desc.chas[23]  = descCha23[0];
  msg.addVal.desc.chas[24]  = descCha24[0];
  msg.addVal.desc.chas[25]  = descCha25[0];
  msg.addVal.desc.chas[26]  = descCha26[0];
  msg.addVal.desc.chas[27]  = descCha27[0];
  msg.addVal.desc.chas[28]  = descCha28[0];
  msg.addVal.desc.chas[29]  = descCha29[0];
  msg.addVal.desc.chas[30]  = descCha30[0];
  msg.addVal.desc.chas[31]  = descCha31[0];
  msg.addVal.desc.chas[32]  = descCha32[0];
  msg.addVal.desc.chas[33]  = descCha33[0];
  msg.addVal.desc.chas[34]  = descCha34[0];
  msg.addVal.desc.chas[35]  = descCha35[0];
  msg.addVal.desc.chas[36]  = descCha36[0];
  msg.addVal.desc.chas[37]  = descCha37[0];
  msg.addVal.desc.chas[38]  = descCha38[0];
  msg.addVal.desc.chas[39]  = descCha39[0];
  msg.addVal.desc.chas[40]  = descCha40[0];
  msg.addVal.desc.chas[41]  = descCha41[0];
  msg.addVal.desc.chas[42]  = descCha42[0];
  msg.addVal.desc.chas[43]  = descCha43[0];
  msg.addVal.desc.chas[44]  = descCha44[0];
  msg.addVal.desc.chas[45]  = descCha45[0];
  msg.addVal.desc.chas[46]  = descCha46[0];
  msg.addVal.desc.chas[47]  = descCha47[0];
  msg.addVal.desc.chas[48]  = descCha48[0];
  msg.addVal.desc.chas[49]  = descCha49[0];
  msg.addVal.desc.chas[50]  = descCha50[0];
  msg.addVal.desc.chas[51]  = descCha51[0];
  msg.addVal.desc.chas[52]  = descCha52[0];
  msg.addVal.desc.chas[53]  = descCha53[0];
  msg.addVal.desc.chas[54]  = descCha54[0];
  msg.addVal.desc.chas[55]  = descCha55[0];
  msg.addVal.desc.chas[56]  = descCha56[0];
  msg.addVal.desc.chas[57]  = descCha57[0];
  msg.addVal.desc.chas[58]  = descCha58[0];
  msg.addVal.desc.chas[59]  = descCha59[0];
  msg.addVal.desc.chas[60]  = descCha60[0];
  msg.addVal.desc.chas[61]  = descCha61[0];
  msg.addVal.desc.chas[62]  = descCha62[0];
  msg.addVal.desc.chas[63]  = descCha63[0];
  msg.addVal.desc.chas[64]  = descCha64[0];
  msg.addVal.desc.chas[65]  = descCha65[0];
  msg.addVal.desc.chas[66]  = descCha66[0];
  msg.addVal.desc.chas[67]  = descCha67[0];
  msg.addVal.desc.chas[68]  = descCha68[0];
  msg.addVal.desc.chas[69]  = descCha69[0];
  msg.addVal.desc.chas[70]  = descCha70[0];
  msg.addVal.desc.chas[71]  = descCha71[0];
  msg.addVal.desc.chas[72]  = descCha72[0];
  msg.addVal.desc.chas[73]  = descCha73[0];
  msg.addVal.desc.chas[74]  = descCha74[0];
  msg.addVal.desc.chas[75]  = descCha75[0];
  msg.addVal.desc.chas[76]  = descCha76[0];
  msg.addVal.desc.chas[77]  = descCha77[0];
  msg.addVal.desc.chas[78]  = descCha78[0];
  msg.addVal.desc.chas[79]  = descCha79[0];
  msg.addVal.desc.chas[80]  = descCha80[0];
  msg.addVal.desc.chas[81]  = descCha81[0];
  msg.addVal.desc.chas[82]  = descCha82[0];
  msg.addVal.desc.chas[83]  = descCha83[0];
  msg.addVal.desc.chas[84]  = descCha84[0];
  msg.addVal.desc.chas[85]  = descCha85[0];
  msg.addVal.desc.chas[86]  = descCha86[0];
  msg.addVal.desc.chas[87]  = descCha87[0];
  msg.addVal.desc.chas[88]  = descCha88[0];
  msg.addVal.desc.chas[89]  = descCha89[0];
  msg.addVal.desc.chas[90]  = descCha90[0];
  msg.addVal.desc.chas[91]  = descCha91[0];
  msg.addVal.desc.chas[92]  = descCha92[0];
  msg.addVal.desc.chas[93]  = descCha93[0];
  msg.addVal.desc.chas[94]  = descCha94[0];
  msg.addVal.desc.chas[95]  = descCha95[0];
  msg.addVal.desc.chas[96]  = descCha96[0];
  msg.addVal.desc.chas[97]  = descCha97[0];
  msg.addVal.desc.chas[98]  = descCha98[0];
  msg.addVal.desc.chas[99]  = descCha99[0];

  msg.addVal.year           = year[0];
  msg.addVal.score          = score[0];
  msg.addVal.genre          = genre[0];
  msg.addVal.rating         = rating[0];
  return msg;
}
