#include "email_system_2.h"
#include <stdlib.h>
#include <unistd.h>
#include <sys/syscall.h>

typedef struct genStr {
  int length;
  int chas[100];
} genStr_t;

typedef struct msg {
  int main;
  genStr username;
  genStr password;
  int index1;
  int flag;
  int user;
  int index2;
  int messid;
} msg_t;

extern int generateRandomValue(_Bool lflag, _Bool uflag, int lbound, int ubound) {
  if (lbound == 0 && ubound == 0) {
    int s;
    syscall(SYS_getrandom, &s, sizeof(int), 1);
    return rand();
  } else {
    int min = lflag ? lbound : lbound+1;
    int max = uflag ? ubound : ubound-1;
    int range = max - min + 1;
    int s;
    syscall(SYS_getrandom, &s, sizeof(int), 1);
    double rnd = ((double) rand())/(1.0 + ((double) RAND_MAX));
    if (rnd < 0) rnd = rnd * -1;
    int value = ((int) (((double) range)*rnd));
    return value + min;
  }
}

msg_t step() {
  updateFunction();
  msg_t msg;
  msg.main              = main[0];

  msg.username.length   = userLength[0];
  msg.username.chas[0]  = userCha0[0];
  msg.username.chas[1]  = userCha1[0];
  msg.username.chas[2]  = userCha2[0];
  msg.username.chas[3]  = userCha3[0];
  msg.username.chas[4]  = userCha4[0];
  msg.username.chas[5]  = userCha5[0];
  msg.username.chas[6]  = userCha6[0];
  msg.username.chas[7]  = userCha7[0];
  msg.username.chas[8]  = userCha8[0];
  msg.username.chas[9]  = userCha9[0];
  msg.username.chas[10] = userCha10[0];
  msg.username.chas[11] = userCha11[0];
  msg.username.chas[12] = userCha12[0];
  msg.username.chas[13] = userCha13[0];
  msg.username.chas[14] = userCha14[0];
  msg.username.chas[15] = userCha15[0];
  msg.username.chas[16] = userCha16[0];
  msg.username.chas[17] = userCha17[0];
  msg.username.chas[18] = userCha18[0];
  msg.username.chas[19] = userCha19[0];
  msg.username.chas[20] = userCha20[0];
  msg.username.chas[21] = userCha21[0];
  msg.username.chas[22] = userCha22[0];
  msg.username.chas[23] = userCha23[0];
  msg.username.chas[24] = userCha24[0];
  msg.username.chas[25] = userCha25[0];
  msg.username.chas[26] = userCha26[0];
  msg.username.chas[27] = userCha27[0];
  msg.username.chas[28] = userCha28[0];
  msg.username.chas[29] = userCha29[0];
  msg.username.chas[30] = userCha30[0];
  msg.username.chas[31] = userCha31[0];
  msg.username.chas[32] = userCha32[0];
  msg.username.chas[33] = userCha33[0];
  msg.username.chas[34] = userCha34[0];
  msg.username.chas[35] = userCha35[0];
  msg.username.chas[36] = userCha36[0];
  msg.username.chas[37] = userCha37[0];
  msg.username.chas[38] = userCha38[0];
  msg.username.chas[39] = userCha39[0];
  msg.username.chas[40] = userCha40[0];
  msg.username.chas[41] = userCha41[0];
  msg.username.chas[42] = userCha42[0];
  msg.username.chas[43] = userCha43[0];
  msg.username.chas[44] = userCha44[0];
  msg.username.chas[45] = userCha45[0];
  msg.username.chas[46] = userCha46[0];
  msg.username.chas[47] = userCha47[0];
  msg.username.chas[48] = userCha48[0];
  msg.username.chas[49] = userCha49[0];
  msg.username.chas[50] = userCha50[0];
  msg.username.chas[51] = userCha51[0];
  msg.username.chas[52] = userCha52[0];
  msg.username.chas[53] = userCha53[0];
  msg.username.chas[54] = userCha54[0];
  msg.username.chas[55] = userCha55[0];
  msg.username.chas[56] = userCha56[0];
  msg.username.chas[57] = userCha57[0];
  msg.username.chas[58] = userCha58[0];
  msg.username.chas[59] = userCha59[0];
  msg.username.chas[60] = userCha60[0];
  msg.username.chas[61] = userCha61[0];
  msg.username.chas[62] = userCha62[0];
  msg.username.chas[63] = userCha63[0];
  msg.username.chas[64] = userCha64[0];
  msg.username.chas[65] = userCha65[0];
  msg.username.chas[66] = userCha66[0];
  msg.username.chas[67] = userCha67[0];
  msg.username.chas[68] = userCha68[0];
  msg.username.chas[69] = userCha69[0];
  msg.username.chas[70] = userCha70[0];
  msg.username.chas[71] = userCha71[0];
  msg.username.chas[72] = userCha72[0];
  msg.username.chas[73] = userCha73[0];
  msg.username.chas[74] = userCha74[0];
  msg.username.chas[75] = userCha75[0];
  msg.username.chas[76] = userCha76[0];
  msg.username.chas[77] = userCha77[0];
  msg.username.chas[78] = userCha78[0];
  msg.username.chas[79] = userCha79[0];
  msg.username.chas[80] = userCha80[0];
  msg.username.chas[81] = userCha81[0];
  msg.username.chas[82] = userCha82[0];
  msg.username.chas[83] = userCha83[0];
  msg.username.chas[84] = userCha84[0];
  msg.username.chas[85] = userCha85[0];
  msg.username.chas[86] = userCha86[0];
  msg.username.chas[87] = userCha87[0];
  msg.username.chas[88] = userCha88[0];
  msg.username.chas[89] = userCha89[0];
  msg.username.chas[90] = userCha90[0];
  msg.username.chas[91] = userCha91[0];
  msg.username.chas[92] = userCha92[0];
  msg.username.chas[93] = userCha93[0];
  msg.username.chas[94] = userCha94[0];
  msg.username.chas[95] = userCha95[0];
  msg.username.chas[96] = userCha96[0];
  msg.username.chas[97] = userCha97[0];
  msg.username.chas[98] = userCha98[0];
  msg.username.chas[99] = userCha99[0];

  msg.password.length   = passLength[0];
  msg.password.chas[0]  = passCha0[0];
  msg.password.chas[1]  = passCha1[0];
  msg.password.chas[2]  = passCha2[0];
  msg.password.chas[3]  = passCha3[0];
  msg.password.chas[4]  = passCha4[0];
  msg.password.chas[5]  = passCha5[0];
  msg.password.chas[6]  = passCha6[0];
  msg.password.chas[7]  = passCha7[0];
  msg.password.chas[8]  = passCha8[0];
  msg.password.chas[9]  = passCha9[0];
  msg.password.chas[10] = passCha10[0];
  msg.password.chas[11] = passCha11[0];
  msg.password.chas[12] = passCha12[0];
  msg.password.chas[13] = passCha13[0];
  msg.password.chas[14] = passCha14[0];
  msg.password.chas[15] = passCha15[0];
  msg.password.chas[16] = passCha16[0];
  msg.password.chas[17] = passCha17[0];
  msg.password.chas[18] = passCha18[0];
  msg.password.chas[19] = passCha19[0];
  msg.password.chas[20] = passCha20[0];
  msg.password.chas[21] = passCha21[0];
  msg.password.chas[22] = passCha22[0];
  msg.password.chas[23] = passCha23[0];
  msg.password.chas[24] = passCha24[0];
  msg.password.chas[25] = passCha25[0];
  msg.password.chas[26] = passCha26[0];
  msg.password.chas[27] = passCha27[0];
  msg.password.chas[28] = passCha28[0];
  msg.password.chas[29] = passCha29[0];
  msg.password.chas[30] = passCha30[0];
  msg.password.chas[31] = passCha31[0];
  msg.password.chas[32] = passCha32[0];
  msg.password.chas[33] = passCha33[0];
  msg.password.chas[34] = passCha34[0];
  msg.password.chas[35] = passCha35[0];
  msg.password.chas[36] = passCha36[0];
  msg.password.chas[37] = passCha37[0];
  msg.password.chas[38] = passCha38[0];
  msg.password.chas[39] = passCha39[0];
  msg.password.chas[40] = passCha40[0];
  msg.password.chas[41] = passCha41[0];
  msg.password.chas[42] = passCha42[0];
  msg.password.chas[43] = passCha43[0];
  msg.password.chas[44] = passCha44[0];
  msg.password.chas[45] = passCha45[0];
  msg.password.chas[46] = passCha46[0];
  msg.password.chas[47] = passCha47[0];
  msg.password.chas[48] = passCha48[0];
  msg.password.chas[49] = passCha49[0];
  msg.password.chas[50] = passCha50[0];
  msg.password.chas[51] = passCha51[0];
  msg.password.chas[52] = passCha52[0];
  msg.password.chas[53] = passCha53[0];
  msg.password.chas[54] = passCha54[0];
  msg.password.chas[55] = passCha55[0];
  msg.password.chas[56] = passCha56[0];
  msg.password.chas[57] = passCha57[0];
  msg.password.chas[58] = passCha58[0];
  msg.password.chas[59] = passCha59[0];
  msg.password.chas[60] = passCha60[0];
  msg.password.chas[61] = passCha61[0];
  msg.password.chas[62] = passCha62[0];
  msg.password.chas[63] = passCha63[0];
  msg.password.chas[64] = passCha64[0];
  msg.password.chas[65] = passCha65[0];
  msg.password.chas[66] = passCha66[0];
  msg.password.chas[67] = passCha67[0];
  msg.password.chas[68] = passCha68[0];
  msg.password.chas[69] = passCha69[0];
  msg.password.chas[70] = passCha70[0];
  msg.password.chas[71] = passCha71[0];
  msg.password.chas[72] = passCha72[0];
  msg.password.chas[73] = passCha73[0];
  msg.password.chas[74] = passCha74[0];
  msg.password.chas[75] = passCha75[0];
  msg.password.chas[76] = passCha76[0];
  msg.password.chas[77] = passCha77[0];
  msg.password.chas[78] = passCha78[0];
  msg.password.chas[79] = passCha79[0];
  msg.password.chas[80] = passCha80[0];
  msg.password.chas[81] = passCha81[0];
  msg.password.chas[82] = passCha82[0];
  msg.password.chas[83] = passCha83[0];
  msg.password.chas[84] = passCha84[0];
  msg.password.chas[85] = passCha85[0];
  msg.password.chas[86] = passCha86[0];
  msg.password.chas[87] = passCha87[0];
  msg.password.chas[88] = passCha88[0];
  msg.password.chas[89] = passCha89[0];
  msg.password.chas[90] = passCha90[0];
  msg.password.chas[91] = passCha91[0];
  msg.password.chas[92] = passCha92[0];
  msg.password.chas[93] = passCha93[0];
  msg.password.chas[94] = passCha94[0];
  msg.password.chas[95] = passCha95[0];
  msg.password.chas[96] = passCha96[0];
  msg.password.chas[97] = passCha97[0];
  msg.password.chas[98] = passCha98[0];
  msg.password.chas[99] = passCha99[0];

  msg.index1            = index1[0];
  msg.flag              = flag[0];
  msg.user              = user[0];
  msg.index2            = index2[0];
  msg.messID            = messID[0];
  return msg;
}
